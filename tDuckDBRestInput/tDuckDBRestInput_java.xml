<?xml version="1.0" encoding="UTF-8"?>
<COMPONENT>
  <HEADER
    PLATEFORM="ALL"
    SERIAL=""
    VERSION="1.0"
    STATUS="PROD"
    COMPATIBILITY="ALL"
    AUTHOR="ESDB"
    RELEASE_DATE="20251130"
    STARTABLE="true"
    LOG4J_ENABLED="true"
    DATA_AUTO_PROPAGATE="false"
  >
    <SIGNATURE/>
  </HEADER>

  <FAMILIES>
    <FAMILY>ESDB/DuckDB</FAMILY>
    <FAMILY>Internet/REST</FAMILY>
    <FAMILY>Big Data/Cloud</FAMILY>
  </FAMILIES>

  <DOCUMENTATION>
    <URL/>
  </DOCUMENTATION>

  <CONNECTORS>
    <CONNECTOR CTYPE="FLOW" MAX_INPUT="0" MAX_OUTPUT="1" LINE_STYLE="1"/>
    <CONNECTOR CTYPE="ITERATE" MAX_INPUT="1" MAX_OUTPUT="0"/>
    <CONNECTOR CTYPE="SUBJOB_OK" MAX_INPUT="1" MAX_OUTPUT="1"/>
    <CONNECTOR CTYPE="SUBJOB_ERROR" MAX_INPUT="0" MAX_OUTPUT="1"/>
    <CONNECTOR CTYPE="COMPONENT_OK" MAX_INPUT="1"/>
    <CONNECTOR CTYPE="COMPONENT_ERROR" MAX_INPUT="1"/>
    <CONNECTOR CTYPE="RUN_IF" MAX_INPUT="1"/>
  </CONNECTORS>

  <PARAMETERS>
    <PARAMETER NAME="API_URL" FIELD="TEXT" REQUIRED="true" NUM_ROW="10" GROUP="API_CONFIG">
      <DEFAULT>"https://api.example.com/data"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="RESPONSE_FORMAT" FIELD="CLOSED_LIST" REQUIRED="true" NUM_ROW="15" GROUP="API_CONFIG">
      <ITEMS DEFAULT="JSON">
        <ITEM NAME="JSON" VALUE="JSON"/>
        <ITEM NAME="NDJSON" VALUE="NDJSON"/>
        <ITEM NAME="CSV" VALUE="CSV"/>
        <ITEM NAME="PARQUET" VALUE="PARQUET"/>
      </ITEMS>
    </PARAMETER>

    <PARAMETER NAME="JSON_PATH" FIELD="TEXT" REQUIRED="false" NUM_ROW="20" GROUP="API_CONFIG">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="USE_AUTHENTICATION" FIELD="CHECK" REQUIRED="false" NUM_ROW="25" GROUP="AUTH_GROUP">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="AUTH_TYPE" FIELD="CLOSED_LIST" REQUIRED="false" NUM_ROW="30" GROUP="AUTH_GROUP" SHOW_IF="USE_AUTHENTICATION == 'true'">
      <ITEMS DEFAULT="BEARER">
        <ITEM NAME="BEARER" VALUE="BEARER"/>
        <ITEM NAME="BASIC" VALUE="BASIC"/>
        <ITEM NAME="API_KEY" VALUE="API_KEY"/>
        <ITEM NAME="OAUTH2_CLIENT" VALUE="OAUTH2_CLIENT"/>
      </ITEMS>
    </PARAMETER>

    <PARAMETER NAME="BEARER_TOKEN" FIELD="PASSWORD" REQUIRED="false" NUM_ROW="35" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'BEARER')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="BASIC_USERNAME" FIELD="TEXT" REQUIRED="false" NUM_ROW="35" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'BASIC')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="BASIC_PASSWORD" FIELD="PASSWORD" REQUIRED="false" NUM_ROW="35" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'BASIC')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="API_KEY_HEADER" FIELD="TEXT" REQUIRED="false" NUM_ROW="35" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'API_KEY')">
      <DEFAULT>"X-API-Key"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="API_KEY_VALUE" FIELD="PASSWORD" REQUIRED="false" NUM_ROW="40" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'API_KEY')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="OAUTH2_TOKEN_URL" FIELD="TEXT" REQUIRED="false" NUM_ROW="35" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'OAUTH2_CLIENT')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="OAUTH2_CLIENT_ID" FIELD="TEXT" REQUIRED="false" NUM_ROW="40" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'OAUTH2_CLIENT')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="OAUTH2_CLIENT_SECRET" FIELD="PASSWORD" REQUIRED="false" NUM_ROW="40" GROUP="AUTH_GROUP" SHOW_IF="(USE_AUTHENTICATION == 'true') AND (AUTH_TYPE == 'OAUTH2_CLIENT')">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="CUSTOM_HEADERS" FIELD="TABLE" REQUIRED="false" NUM_ROW="45" GROUP="HEADERS_GROUP">
      <ITEMS>
        <ITEM NAME="HEADER_NAME" VALUE=""/>
        <ITEM NAME="HEADER_VALUE" VALUE=""/>
      </ITEMS>
    </PARAMETER>

    <PARAMETER NAME="USE_CACHE" FIELD="CHECK" REQUIRED="false" NUM_ROW="50" GROUP="CACHE_GROUP">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="CACHE_TTL_SECONDS" FIELD="TEXT" REQUIRED="false" NUM_ROW="55" GROUP="CACHE_GROUP" SHOW_IF="USE_CACHE == 'true'">
      <DEFAULT>3600</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="CACHE_KEY" FIELD="TEXT" REQUIRED="false" NUM_ROW="55" GROUP="CACHE_GROUP" SHOW_IF="USE_CACHE == 'true'">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="USE_PAGINATION" FIELD="CHECK" REQUIRED="false" NUM_ROW="60" GROUP="PAGINATION_GROUP">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="PAGINATION_TYPE" FIELD="CLOSED_LIST" REQUIRED="false" NUM_ROW="65" GROUP="PAGINATION_GROUP" SHOW_IF="USE_PAGINATION == 'true'">
      <ITEMS DEFAULT="OFFSET">
        <ITEM NAME="OFFSET" VALUE="OFFSET"/>
        <ITEM NAME="PAGE" VALUE="PAGE"/>
        <ITEM NAME="CURSOR" VALUE="CURSOR"/>
        <ITEM NAME="LINK_HEADER" VALUE="LINK_HEADER"/>
      </ITEMS>
    </PARAMETER>

    <PARAMETER NAME="PAGE_SIZE" FIELD="TEXT" REQUIRED="false" NUM_ROW="70" GROUP="PAGINATION_GROUP" SHOW_IF="USE_PAGINATION == 'true'">
      <DEFAULT>100</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="MAX_PAGES" FIELD="TEXT" REQUIRED="false" NUM_ROW="70" GROUP="PAGINATION_GROUP" SHOW_IF="USE_PAGINATION == 'true'">
      <DEFAULT>0</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="OFFSET_PARAM" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'OFFSET')">
      <DEFAULT>"offset"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="LIMIT_PARAM" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'OFFSET')">
      <DEFAULT>"limit"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="PAGE_PARAM" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'PAGE')">
      <DEFAULT>"page"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="PER_PAGE_PARAM" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'PAGE')">
      <DEFAULT>"per_page"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="CURSOR_PARAM" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'CURSOR')">
      <DEFAULT>"cursor"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="CURSOR_JSON_PATH" FIELD="TEXT" REQUIRED="false" NUM_ROW="75" GROUP="PAGINATION_GROUP" SHOW_IF="(USE_PAGINATION == 'true') AND (PAGINATION_TYPE == 'CURSOR')">
      <DEFAULT>"$.next_cursor"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="POST_SQL" FIELD="MEMO_SQL" REQUIRED="false" NUM_ROW="80" NB_LINES="4" GROUP="SQL_GROUP">
      <DEFAULT>"-- Optional SQL to transform/filter the API response\n-- SELECT * FROM api_response WHERE condition"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="SCHEMA" FIELD="SCHEMA_TYPE" REQUIRED="true" NUM_ROW="90">
      <DEFAULT/>
    </PARAMETER>

    <PARAMETER NAME="DIE_ON_ERROR" FIELD="CHECK" REQUIRED="false" NUM_ROW="95" GROUP="ERROR_GROUP">
      <DEFAULT>true</DEFAULT>
    </PARAMETER>
  </PARAMETERS>

  <ADVANCED_PARAMETERS>
    <PARAMETER NAME="TIMEOUT_SECONDS" FIELD="TEXT" REQUIRED="false" NUM_ROW="10" GROUP="HTTP_CONFIG">
      <DEFAULT>60</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="RETRY_COUNT" FIELD="TEXT" REQUIRED="false" NUM_ROW="10" GROUP="HTTP_CONFIG">
      <DEFAULT>3</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="RETRY_DELAY_MS" FIELD="TEXT" REQUIRED="false" NUM_ROW="15" GROUP="HTTP_CONFIG">
      <DEFAULT>1000</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="USER_AGENT" FIELD="TEXT" REQUIRED="false" NUM_ROW="20" GROUP="HTTP_CONFIG">
      <DEFAULT>"ESDB-DuckDB-Client/1.0"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="MEMORY_LIMIT" FIELD="TEXT" REQUIRED="false" NUM_ROW="25" GROUP="DUCKDB_CONFIG">
      <DEFAULT>"2GB"</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="THREADS" FIELD="TEXT" REQUIRED="false" NUM_ROW="25" GROUP="DUCKDB_CONFIG">
      <DEFAULT>4</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="DEBUG_MODE" FIELD="CHECK" REQUIRED="false" NUM_ROW="30" GROUP="DEBUG">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="LOG_RESPONSE" FIELD="CHECK" REQUIRED="false" NUM_ROW="30" GROUP="DEBUG">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="SAVE_RAW_RESPONSE" FIELD="CHECK" REQUIRED="false" NUM_ROW="35" GROUP="DEBUG">
      <DEFAULT>false</DEFAULT>
    </PARAMETER>

    <PARAMETER NAME="RAW_RESPONSE_PATH" FIELD="FILE" REQUIRED="false" NUM_ROW="35" GROUP="DEBUG" SHOW_IF="SAVE_RAW_RESPONSE == 'true'">
      <DEFAULT>""</DEFAULT>
    </PARAMETER>
  </ADVANCED_PARAMETERS>

  <CODEGENERATION>
    <IMPORTS>
      <IMPORT NAME="DuckDB-Driver" MODULE="duckdb_jdbc-1.0.0.jar" MVN="mvn:org.duckdb/duckdb_jdbc/1.0.0" REQUIRED="true"/>
      <IMPORT NAME="httpclient" MODULE="httpclient-4.5.14.jar" MVN="mvn:org.apache.httpcomponents/httpclient/4.5.14" REQUIRED="true"/>
      <IMPORT NAME="httpcore" MODULE="httpcore-4.4.16.jar" MVN="mvn:org.apache.httpcomponents/httpcore/4.4.16" REQUIRED="true"/>
      <IMPORT NAME="gson" MODULE="gson-2.10.1.jar" MVN="mvn:com.google.code.gson/gson/2.10.1" REQUIRED="true"/>
      <IMPORT NAME="commons-io" MODULE="commons-io-2.11.0.jar" MVN="mvn:commons-io/commons-io/2.11.0" REQUIRED="true"/>
    </IMPORTS>
  </CODEGENERATION>

  <RETURNS>
    <RETURN NAME="NB_LINE" TYPE="id_Integer" AVAILABILITY="AFTER"/>
    <RETURN NAME="NB_API_CALLS" TYPE="id_Integer" AVAILABILITY="AFTER"/>
    <RETURN NAME="NB_PAGES" TYPE="id_Integer" AVAILABILITY="AFTER"/>
    <RETURN NAME="TOTAL_RESPONSE_SIZE" TYPE="id_Long" AVAILABILITY="AFTER"/>
    <RETURN NAME="PROCESSING_TIME_MS" TYPE="id_Long" AVAILABILITY="AFTER"/>
    <RETURN NAME="CACHE_HIT" TYPE="id_Boolean" AVAILABILITY="AFTER"/>
    <RETURN NAME="NB_ERRORS" TYPE="id_Integer" AVAILABILITY="AFTER"/>
  </RETURNS>
</COMPONENT>
